<!DOCTYPE html>
<html>
<head>
    <title>Phishing Campaign Results</title>
</head>
<body>
    <h1>Results: {{ campaign.name }}</h1>
    <h2>Campaign Summary</h2>
        <ul>
           <li>Total Targets: {{ targets|length }}</li>
           <li>Emails Opened: {{ targets|selectattr('email_opened')|list|length }}</li>
           <li>Links Clicked: {{ targets|selectattr('link_clicked')|list|length }}</li>
           <li>Data Submitted: {{ targets|selectattr('data_submitted')|list|length }}</li>
           <li>Reported as Phish: {{ targets|selectattr('reported_phish')|list|length }}</li>
       </ul>
        <table border="1" cellpadding="5">
        <tr>
            <th>User</th>
            <th>Email Sent</th>
            <th>Email Opened</th>
            <th>Link Clicked</th>
            <th>Data Submitted</th>
            <th>Reported as Phish</th>
        </tr>
	<tr {% if target.user_id in repeat_offenders %} style="background:#ffcccc;" title="Repeat Offender"{% endif %}>
   	 <td>{{ users[target.user_id].username }}</td>
    	<!-- other columns -->
	</tr>
        {% for target in targets %}
        <tr>
            <td>{{ users[target.user_id].username }}</td>
            <td>{{ target.email_sent if target.email_sent else '-' }}</td>
            <td>{{ target.email_opened if target.email_opened else '-' }}</td>
            <td>{{ target.link_clicked if target.link_clicked else '-' }}</td>
            <td>{{ target.data_submitted if target.data_submitted else '-' }}</td>
            <td>{{ target.reported_phish if target.reported_phish else '-' }}</td>
        </tr>
        {% endfor %}
	<th>Risk Score</th>
		<!-- in your row -->
		<td>
  		{{ user_risk[target.user_id] }} 
  		({{ risk_level(user_risk[target.user_id]) }})
		</td>
    </table>
    <p><a href="{{ url_for('phishing.campaigns_list') }}">Back to Campaigns</a></p>
</body>
</html>